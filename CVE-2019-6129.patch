From a0ca4293454ef65e67efca5dc440c601d2835e90 Mon Sep 17 00:00:00 2001
From: tangyaofang <tangyaofang6666@163.com>
Date: Mon, 10 Jun 2019 11:30:15 +0800
Subject: [PATCH] Repair of CVE-2019-6129

---
 contrib/tools/pngcp.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/contrib/tools/pngcp.c b/contrib/tools/pngcp.c
index 16d4e7f4d..a02d5b7ff 100644
--- a/contrib/tools/pngcp.c
+++ b/contrib/tools/pngcp.c
@@ -506,7 +506,7 @@ static void
 display_clean_read(struct display *dp)
 {
    if (dp->read_pp != NULL)
-      png_destroy_read_struct(&dp->read_pp, NULL, NULL);
+      png_destroy_read_struct(&dp->read_pp, (dp->ip!=NULL ? &dp->ip : NULL), NULL);
 
    if (dp->fp != NULL)
    {

